const fs = require("fs"); let file = fs.readFileSync("src/pages/ProfilePage.jsx", "utf8"); let startIdx = file.indexOf("  const navigate = useNavigate();"); let endIdx = file.indexOf("  if (!user) {"); let replacement = `  const navigate = useNavigate();\n\n  const fetchUserDashboardData = React.useCallback(async (userId) => {\n     const { data: casesData } = await supabase.from("cases").select("*").eq("user_id", userId).order("created_at", { ascending: false });\n     if (casesData && casesData.length > 0) {\n        setUserCases(casesData.map(c => ({ id: c.id, title: c.description ? c.description.substring(0, 30) + "..." : "Case #" + c.id.substring(0, 6), subtitle: c.incident_location ? "Incident at " + c.incident_location : "Legal Matter", status: c.status || "Active", date: c.created_at || new Date().toISOString(), docUrl: c.pdf_url || c.evidence_url || null })));\n        setActiveUserCases(casesData.map(c => ({ id: c.id, title: c.description ? c.description.substring(0, 30) + "..." : "Case #" + c.id.substring(0, 6), subtitle: c.incident_location ? "Incident at " + c.incident_location : "Legal Matter", status: c.status || "Active", date: c.created_at || new Date().toISOString(), docUrl: c.pdf_url || c.evidence_url || null })).filter(c => c.status !== "Closed"));\n     } else {\n        setUserCases([]);\n        setActiveUserCases([]);\n     }\n     const { data: lawyersData } = await supabase.from("lawyers").select("*").limit(3);\n     if (lawyersData && lawyersData.length > 0) {\n        setRecommendedLawyers(lawyersData.map(l => ({ name: l.full_name, domain: l.domain || "General", rating: "4.8", img: "https://ui-avatars.com/api/?name=" + encodeURIComponent(l.full_name) + "&background=random" })));\n     } else {\n        setRecommendedLawyers([]);\n     }\n  }, []);\n\n  const fetchLawyerDashboardData = React.useCallback(async () => {\n    const { data: casesData } = await supabase.from("cases").select("*").limit(5);\n    if (casesData && casesData.length > 0) {\n      setLawyerActiveCases(casesData.map(c => ({ id: c.id, title: c.description?.substring(0, 20) + "...", client_name: "Platform User", status: c.status || "Active", next_step: "Pending Review" })));\n      setLawyerNewRequests(casesData.slice(0, 3).map(c => ({ title: c.description?.substring(0, 20) + " - Request", amount: "Consultation", loc: c.incident_location || "Remote", created_at: c.created_at })));\n    } else {\n      setLawyerActiveCases([]);\n      setLawyerNewRequests([]);\n    }\n    setRecentActivity([]);\n    setUpcomingHearings([]);\n  }, []);\n\n  const fetchUserDataWrapper = React.useCallback(async (userId, email, userRole) => {\n    const { data: lData } = await supabase.from("lawyers").select("*").eq("email", email).single();\n    let finalRole = userRole;\n    if (lData) {\n      setLawyerData(lData);\n      setRole("Lawyer");\n      finalRole = "Lawyer";\n    }\n    if (finalRole === "Lawyer") {\n      fetchLawyerDashboardData();\n    } else {\n      fetchUserDashboardData(userId);\n    }\n  }, [fetchLawyerDashboardData, fetchUserDashboardData]);\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      if (!session) {\n        navigate("/login");\n      } else {\n        setUser(session.user);\n        const uRole = session.user.user_metadata?.role || "User";\n        setRole(uRole);\n        fetchUserDataWrapper(session.user.id, session.user.email, uRole);\n      }\n    });\n  }, [navigate, fetchUserDataWrapper]);\n\n`; file = file.substring(0, startIdx) + replacement + file.substring(endIdx); fs.writeFileSync("src/pages/ProfilePage.jsx", file); console.log("Success");
